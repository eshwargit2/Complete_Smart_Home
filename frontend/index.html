<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <title>Smart Home Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: white;
    }

    .dashboard-container {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: auto;
      gap: 20px;
      align-items: stretch;
    }

    .clock-card { grid-column: 1; grid-row: 1; }
    .weather-card { grid-column: 2; grid-row: 1; }
    .tank-card { grid-column: 3; grid-row: 1; }
    .gate-card { grid-column: 4; grid-row: 1; }
    .relay-grid { grid-column: 1 / -1; grid-row: 2; }

    .card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 280px;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
    }

    .card-title {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 20px;
      text-align: center;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    /* Clock Card */
    .clock-card {
      background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
      text-align: center;
    }

    .time-display {
      font-size: 2.5rem;
      font-weight: bold;
      margin: 15px 0;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .date-display {
      font-size: 1.2rem;
      opacity: 0.9;
    }

    /* Weather Card */
    .weather-card {
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      color: #333;
    }

    .weather-main {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
    }

    .weather-icon {
      font-size: 4rem;
      color: #ff6b6b;
    }

    .temperature {
      font-size: 3rem;
      font-weight: bold;
    }

    .weather-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 20px;
    }

    .weather-item {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(255, 255, 255, 0.3);
      padding: 10px;
      border-radius: 10px;
    }

    /* Tank Card */
    .tank-card {
      background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
    }

    .tank-container {
      position: relative;
      width: 120px;
      height: 250px;
      border: 4px solid #00b8d4;
      border-radius: 15px;
      overflow: hidden;
      margin: 20px auto;
      background: rgba(255, 255, 255, 0.1);
    }

    .water {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 0%;
      transition: height 1s ease, background 0.8s ease;
      border-radius: 0 0 11px 11px;
    }

    .water.low { 
      background: linear-gradient(to top, #ff6b6b, #ff8e8e);
      animation: pulse 2s infinite;
    }
    .water.medium { 
      background: linear-gradient(to top, #fdcb6e, #e17055);
    }
    .water.high { 
      background: linear-gradient(to top, #00b894, #55efc4);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .percentage {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.3rem;
      font-weight: bold;
      color: #fff;
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
      z-index: 10;
    }

    /* Relay Grid */
    .relay-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
    }

    .relay-card {
      min-height: 200px;
    }

    .relay-button {
      background: linear-gradient(135deg, #636e72, #2d3436);
      border: none;
      border-radius: 15px;
      padding: 25px 15px;
      color: white;
      font-weight: bold;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .relay-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
    }

    .relay-button.on {
      background: linear-gradient(135deg, #00b894, #55efc4);
      animation: glow 2s infinite alternate;
    }

    @keyframes glow {
      from { box-shadow: 0 4px 15px rgba(0, 184, 148, 0.4); }
      to { box-shadow: 0 6px 25px rgba(0, 184, 148, 0.8); }
    }

    .relay-icon {
      font-size: 2.5rem;
      margin-bottom: 10px;
      display: block;
    }

    .relay-button.on .relay-icon {
      color: #fdcb6e;
      text-shadow: 0 0 10px #fdcb6e;
    }

    /* Gate Control */
    .gate-card {
      background: linear-gradient(135deg, #a29bfe, #6c5ce7);
    }

    .gate-button {
      width: 100%;
      background: linear-gradient(135deg, #fd79a8, #e84393);
      border: none;
      border-radius: 15px;
      padding: 25px;
      color: white;
      font-weight: bold;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
    }

    .gate-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(232, 67, 147, 0.4);
    }

    .gate-button.open {
      background: linear-gradient(135deg, #00b894, #55efc4);
    }

    .gate-icon {
      font-size: 2rem;
      margin-bottom: 8px;
      display: block;
    }

    /* Fire Alert */
    .fire-alert {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      padding: 20px;
      border-radius: 15px;
      font-weight: bold;
      font-size: 1.1rem;
      box-shadow: 0 8px 25px rgba(255, 107, 107, 0.5);
      transform: translateX(400px);
      transition: transform 0.5s ease;
      z-index: 1000;
      max-width: 300px;
    }

    .fire-alert.show {
      transform: translateX(0);
      animation: fireFlash 1s infinite alternate;
    }

    @keyframes fireFlash {
      from { box-shadow: 0 8px 25px rgba(255, 107, 107, 0.5); }
      to { box-shadow: 0 12px 35px rgba(255, 107, 107, 0.9); }
    }

    .fire-icon {
      font-size: 1.5rem;
      margin-right: 10px;
      animation: fireFlicker 0.5s infinite alternate;
    }

    @keyframes fireFlicker {
      from { transform: scale(1); }
      to { transform: scale(1.1); }
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .dashboard-container {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .clock-card { grid-column: 1; grid-row: 1; }
      .weather-card { grid-column: 2; grid-row: 1; }
      .tank-card { grid-column: 1; grid-row: 2; }
      .gate-card { grid-column: 2; grid-row: 2; }
      .relay-grid { grid-column: 1 / -1; grid-row: 3; }
    }

    @media (max-width: 768px) {
      .dashboard-container {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .clock-card, .weather-card, .tank-card, .gate-card, .relay-grid {
        grid-column: 1;
      }
      
      .relay-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .time-display {
        font-size: 2rem;
      }
      
      .temperature {
        font-size: 2.5rem;
      }
      
      .card {
        min-height: 240px;
        padding: 20px;
      }
    }

    @media (max-width: 480px) {
      .relay-grid {
        grid-template-columns: 1fr;
      }
      
      .dashboard-container {
        gap: 10px;
      }
      
      .card {
        padding: 15px;
        min-height: 200px;
      }
    }

    /* Loading animation */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .voice-control-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      z-index: 1000;
    }

    .voice-btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border: none;
      border-radius: 50%;
      width: 80px;
      height: 80px;
      color: white;
      font-size: 2rem;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(15px);
      border: 3px solid rgba(255, 255, 255, 0.2);
      position: relative;
      overflow: hidden;
    }

    .voice-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
      transform: translateX(-100%);
      transition: transform 0.6s;
    }

    .voice-btn:hover::before {
      transform: translateX(100%);
    }

    .voice-btn:hover {
      transform: scale(1.1) translateY(-2px);
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
      border-color: rgba(255, 255, 255, 0.4);
    }

    .voice-btn.active {
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      animation: voicePulse 1.5s infinite;
      box-shadow: 0 15px 40px rgba(255, 107, 107, 0.6);
    }

    @keyframes voicePulse {
      0%, 100% { 
        transform: scale(1.1);
        box-shadow: 0 15px 40px rgba(255, 107, 107, 0.6);
      }
      50% { 
        transform: scale(1.15);
        box-shadow: 0 20px 50px rgba(255, 107, 107, 0.8);
      }
    }

    .live-text {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      border-radius: 30px;
      padding: 18px 30px;
      color: white;
      font-weight: 500;
      font-size: 1.1rem;
      border: 2px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      max-width: 350px;
      text-align: center;
      min-height: 25px;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .live-text::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.05) 50%, transparent 70%);
      transform: translateX(-100%);
      transition: transform 0.8s;
    }

    .live-text.listening::before {
      transform: translateX(100%);
    }

    .live-text.listening {
      background: rgba(255, 107, 107, 0.15);
      border-color: rgba(255, 107, 107, 0.4);
      animation: textGlow 2s infinite alternate;
      transform: scale(1.02);
    }

    @keyframes textGlow {
      from { 
        box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        border-color: rgba(255, 107, 107, 0.4);
      }
      to { 
        box-shadow: 0 15px 40px rgba(255, 107, 107, 0.6);
        border-color: rgba(255, 107, 107, 0.6);
      }
    }

  </style>
</head>
<body>
  <div class="dashboard-container" style="margin-top:20px;">
    <!-- Clock Card -->
    <div class="card clock-card">
      <h2 class="card-title">
        <i class="fas fa-clock"></i> Current Time
      </h2>
      <div class="time-display" id="current-time">--:--:--</div>
      <div class="date-display" id="current-date">Loading...</div>
    </div>

    <!-- Weather Card -->
    <div class="card weather-card">
      <h2 class="card-title">
        <i class="fas fa-cloud-sun"></i> Weather
      </h2>
      <div class="weather-main">
        <i class="fas fa-sun weather-icon"></i>
        <div class="temperature" id="temperature">
          <span class="loading"></span>
        </div>
      </div>
      <div class="weather-details">
        <div class="weather-item">
          <i class="fas fa-thermometer-half"></i>
          <span>Feels like: <span id="feelsLike">--¬∞C</span></span>
        </div>
        <div class="weather-item">
          <i class="fas fa-tint"></i>
          <span>Humidity: <span id="humidity">--%</span></span>
        </div>
        <div class="weather-item">
          <i class="fas fa-compress-arrows-alt"></i>
          <span>Pressure: <span id="pressure">-- hPa</span></span>
        </div>
        <div class="weather-item">
          <i class="fas fa-temperature-low"></i>
          <span>Min/Max: <span id="min-temp">--¬∞/--¬∞</span></span>
        </div>
      </div>
    </div>

    <!-- Water Tank Card -->
    <div class="card tank-card">
      <h2 class="card-title">
        <i class="fas fa-water"></i> Water Level
      </h2>
      <div class="tank-container">
        <div class="water" id="water"></div>
        <div class="percentage" id="percentage">0%</div>
      </div>
    </div>

    <!-- Gate Control Card -->
    <div class="card gate-card">
      <h2 class="card-title">
        <i class="fas fa-door-open"></i> Gate Control
      </h2>
      <button id="gateBtn" class="gate-button" onclick="toggleGate()">
        <i class="fas fa-door-closed gate-icon"></i>
        <span id="gateStatus">Open Gate</span>
      </button>
    </div>

    <!-- Relay Control Grid -->
    <div class="relay-grid">
      <div class="card relay-card" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);">
        <h3 style="text-align: center; margin-bottom: 15px; color: #333;">
          <i class="fas fa-home"></i> Room 1
        </h3>
        <button id="relay1" class="relay-button off" onclick="toggleRelay(1)">
          <i class="fas fa-lightbulb relay-icon"></i>
          <div>LED Light</div>
        </button>
      </div>
      
      <div class="card relay-card" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
        <h3 style="text-align: center; margin-bottom: 15px; color: #333;">
          <i class="fas fa-bed"></i> Bedroom
        </h3>
        <button id="relay2" class="relay-button off" onclick="toggleRelay(2)">
          <i class="fas fa-lightbulb relay-icon"></i>
          <div>LED Light</div>
        </button>
      </div>
      
      <div class="card relay-card" style="background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);">
        <h3 style="text-align: center; margin-bottom: 15px; color: #333;">
          <i class="fas fa-utensils"></i> Kitchen
        </h3>
        <button id="relay3" class="relay-button off" onclick="toggleRelay(3)">
          <i class="fas fa-lightbulb relay-icon"></i>
          <div>LED Light</div>
        </button>
      </div>
      
      <div class="card relay-card" style="background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);">
        <h3 style="text-align: center; margin-bottom: 15px; color: #333;">
          <i class="fas fa-couch"></i> Living Room
        </h3>
        <button id="relay4" class="relay-button off" onclick="toggleRelay(4)">
          <i class="fas fa-lightbulb relay-icon"></i>
          <div>LED Light</div>
        </button>
      </div>
    </div>
  </div>

  <!-- Fire Alert -->
  <div id="fireAlert" class="fire-alert">
    <i class="fas fa-fire fire-icon"></i>
    üî• Fire Detected! Take Action Immediately!
  </div>

  <!-- Voice Control -->
  <div class="voice-control-container">
    <div id="liveText" class="live-text">Say command...</div>
    <button id="voiceBtn" class="voice-btn">üé§</button>
  </div>

  <script>
    // Update current date and time
    function updateTime() {   
      const now = new Date();
      const dateOptions = { 
        weekday: 'long',
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      };
      const timeOptions = { 
        hour: '2-digit', 
        minute: '2-digit', 
        second: '2-digit',
        hour12: true
      };
      
      document.getElementById('current-date').textContent = 
        now.toLocaleDateString(undefined, dateOptions);
      document.getElementById('current-time').textContent = 
        now.toLocaleTimeString(undefined, timeOptions);
    }
    
    setInterval(updateTime, 1000);
    updateTime();

    // Weather API
    const apiKey = `200726d456c135e07004238f8b4eb9d4`;
    const url = `https://api.openweathermap.org/data/2.5/weather?q=salem&appid=${apiKey}&units=metric`;

    fetch(url)
      .then(res => res.json())
      .then(data => {
        if(data.cod === 200) {
          document.getElementById("temperature").textContent = `${Math.round(data.main.temp)}¬∞C`;
          document.getElementById("min-temp").textContent = 
            `${Math.round(data.main.temp_min)}¬∞/${Math.round(data.main.temp_max)}¬∞`;
          document.getElementById("humidity").textContent = `${data.main.humidity}%`;
          document.getElementById("pressure").textContent = `${data.main.pressure} hPa`;
          document.getElementById("feelsLike").textContent = `${Math.round(data.main.feels_like)}¬∞C`;
          
          // Update weather icon based on weather
          const weatherIcon = document.querySelector('.weather-icon');
          const weatherMain = data.weather[0].main.toLowerCase();
          
          if (weatherMain.includes('rain')) {
            weatherIcon.className = 'fas fa-cloud-rain weather-icon';
          } else if (weatherMain.includes('cloud')) {
            weatherIcon.className = 'fas fa-cloud weather-icon';
          } else if (weatherMain.includes('clear')) {
            weatherIcon.className = 'fas fa-sun weather-icon';
          } else {
            weatherIcon.className = 'fas fa-cloud-sun weather-icon';
          }
        } else {
          console.log(`Weather Error: ${data.message}`);
          document.getElementById("temperature").textContent = 'N/A';
        }
      })
      .catch(err => { 
        console.error('Weather fetch error:', err);
        document.getElementById("temperature").textContent = 'N/A';
      });

    // Smart Home Control Logic
    let relays = {1: false, 2: false, 3: false, 4: false};
    let gateOpen = false;

    // Voice Assistant
    const roomMap = {
      "room lights": 1, 
      "room one": 1,
      "bedroom lights": 2,
      "bedroom": 2,
      "kitchen lights": 3,
      "kitchen": 3,
      "living room lights": 4,
      "living room": 4,
      "gate": "gate"
    };

    const liveText = document.getElementById("liveText");
    const voiceBtn = document.getElementById("voiceBtn");
    
    // Check if browser supports SpeechRecognition
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition = null;
    let isListening = false;
    
    if (SpeechRecognition) {
      recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.lang = 'en-US';
      recognition.interimResults = true;
      
      recognition.onresult = function(event) {
        let transcript = "";
        for (let i = event.resultIndex; i < event.results.length; i++) {
          if (event.results[i].isFinal) {
            transcript += event.results[i][0].transcript;
          } else {
            transcript += event.results[i][0].transcript;
          }
        }
        
        liveText.textContent = transcript;
        
        // Check if the result is final
        const finalResult = event.results[event.results.length - 1];
        if (finalResult.isFinal) {
          handleCommand(transcript.toLowerCase().trim());
        }
      };
      
      recognition.onerror = function(event) {
        console.error('Speech recognition error', event.error);
        stopListening();
        liveText.textContent = "Error: " + event.error;
        speak("Sorry, I encountered an error. Please try again.");
      };
      
      recognition.onend = function() {
        if (isListening) {
          // If we're still supposed to be listening, restart
          try {
            recognition.start();
          } catch (e) {
            console.error('Recognition restart error:', e);
            stopListening();
          }
        }
      };
    } else {
      console.log("Speech Recognition API not supported in this browser");
      voiceBtn.disabled = true;
      liveText.textContent = "Voice control not supported";
    }
    
    function startListening() {
      if (recognition) {
        try {
          recognition.start();
          isListening = true;
          voiceBtn.classList.add('active');
          liveText.classList.add('listening');
          liveText.textContent = "Listening...";
          speak("I'm listening. What can I help with?");
        } catch (e) {
          console.error('Recognition start error:', e);
        }
      }
    }
    
    function stopListening() {
      if (recognition) {
        isListening = false;
        recognition.stop();
        voiceBtn.classList.remove('active');
        liveText.classList.remove('listening');
        liveText.textContent = "Say command...";
      }
    }
    
    voiceBtn.addEventListener('click', function() {
      if (isListening) {
        stopListening();
      } else {
        startListening();
      }
    });
    
    function speak(message) {
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(message);
        utterance.rate = 1.0;
        utterance.pitch = 1.0;
        window.speechSynthesis.speak(utterance);
      }
    }
    
    function handleCommand(command) {
      console.log("Command received:", command);
      
      let handled = false;
      
      // Check for light commands
      for (const [roomName, roomId] of Object.entries(roomMap)) {
        if (command.includes(roomName)) {
          if (command.includes("on") || command.includes("turn on") || command.includes("switch on")) {
            if (roomId === "gate") {
              if (!gateOpen) toggleGate();
              speak(`Opening the gate`);
            } else {
              if (!relays[roomId]) toggleRelay(roomId);
              speak(`Turning on ${roomName}`);
            }
            handled = true;
          } else if (command.includes("off") || command.includes("turn off") || command.includes("switch off")) {
            if (roomId === "gate") {
              if (gateOpen) toggleGate();
              speak(`Closing the gate`);
            } else {
              if (relays[roomId]) toggleRelay(roomId);
              speak(`Turning off ${roomName}`);
            }
            handled = true;
          } else if (command.includes("toggle") || command.includes("switch")) {
            if (roomId === "gate") {
              toggleGate();
              speak(`Toggling the gate`);
            } else {
              toggleRelay(roomId);
              speak(`Toggling ${roomName}`);
            }
            handled = true;
          }
          break;
        }
      }
      
      // Check for status commands
      if (command.includes("status") || command.includes("what's on")) {
        const onDevices = [];
        for (let i = 1; i <= 4; i++) {
          if (relays[i]) {
            onDevices.push(Object.keys(roomMap).find(key => roomMap[key] === i));
          }
        }
        
        if (onDevices.length > 0) {
          speak(`Currently, ${onDevices.join(", ")} are turned on`);
        } else {
          speak("All lights are currently off");
        }
        handled = true;
      }
      
      // Check for help command
      if (command.includes("help") || command.includes("what can you do")) {
        speak("You can control lights in room one, bedroom, kitchen, and living room. You can also control the gate. Try saying 'turn on bedroom lights' or 'open the gate'.");
        handled = true;
      }
      
      if (!handled) {
        speak("Sorry, I didn't understand that command. Try saying 'turn on bedroom lights' or 'open the gate'.");
      }
    }

    async function fetchStatus() {
      try {
        const res = await fetch("/status");
        const data = await res.json();

        // Update relay states
        for (let i = 1; i <= 4; i++) {
          const btn = document.getElementById("relay" + i);
          relays[i] = data[i] === "on";
          btn.className = "relay-button " + (relays[i] ? "on" : "off");
        }

        // Update water level
        const waterDiv = document.getElementById("water");
        const percDiv = document.getElementById("percentage");
        let level = data.water || 0;
        
        percDiv.textContent = level + "%";
        waterDiv.style.height = level + "%";

        if (level < 30) {
          waterDiv.className = "water low";
        } else if (level < 70) {
          waterDiv.className = "water medium";
        } else {
          waterDiv.className = "water high";
        }

        // Update fire alert
        const fireAlert = document.getElementById("fireAlert");
        if (data.fire === "on") {
          fireAlert.classList.add("show");
          if (isListening) {
            speak("Warning! Fire detected! Please take immediate action!");
           
          }
        } else {
          fireAlert.classList.remove("show");
        
        }

        // Update gate status
        const gateBtn = document.getElementById("gateBtn");
        const gateStatus = document.getElementById("gateStatus");
        const gateIcon = gateBtn.querySelector('.gate-icon');
        gateOpen = data.gate === "open";
        
        if (gateOpen) {
          gateBtn.classList.add("open");
          gateStatus.textContent = "Close Gate";
          gateIcon.className = "fas fa-door-open gate-icon";
        } else {
          gateBtn.classList.remove("open");
          gateStatus.textContent = "Open Gate";
          gateIcon.className = "fas fa-door-closed gate-icon";
        }

      } catch(e) {
        console.log("Status fetch error:", e);
      }
    }

    async function toggleRelay(id) {
      try {
        await fetch("/toggle/" + id);
        fetchStatus();
      } catch(e) {
        console.log("Relay toggle error:", e);
        speak("Error toggling the light");
      }
    }

    async function toggleGate() {
      try {
        await fetch("/gate/toggle");
        fetchStatus();
      } catch(e) {
        console.log("Gate toggle error:", e);
        speak("Error toggling the gate");
      }
    }

    // Initial fetch and periodic updates
    setInterval(fetchStatus, 20);
    fetchStatus();        

    // Add some interactive feedback
    document.querySelectorAll('.relay-button').forEach(button => {
      button.addEventListener('click', function() {
        this.style.transform = 'scale(0.95)';
        setTimeout(() => {
          this.style.transform = '';
        }, 150);
      });
    });

    // Console log for debugging
    console.log('Smart Home Dashboard loaded successfully! üè†‚ú®');
  </script>
</body>
</html>